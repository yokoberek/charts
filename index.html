<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Environmental Monitoring Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        select, #time-filter {
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ced4da;
            border-radius: 4px;
        }
        #chart-container {
            height: 500px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Environmental Monitoring Dashboard</h1>
        <div class="controls">
            <select id="system-selector">
                <option value="all">All Systems</option>
                <option value="aqms">Air Quality Monitoring System</option>
                <option value="wqms">Water Quality Monitoring System</option>
                <option value="sqms">Soil Quality Monitoring System</option>
                <option value="gqms">Gas Quality Monitoring System</option>
            </select>
            <select id="time-filter">
                <option value="7d">Last 7 Days</option>
                <option value="3d">Last 3 Days</option>
                <option value="24h">Last 24 Hours</option>
                <option value="12h">Last 12 Hours</option>
                <option value="3h">Last 3 Hours</option>
            </select>
        </div>
        <div id="chart-container"></div>
    </div>

    <script>
        const datasets = {
            aqms: [
                { name: "PM2.5 (µg/m³)", data: [], color: "#1A56DB", range: [0, 55] },
                { name: "PM10 (µg/m³)", data: [], color: "#7E3BF2", range: [0, 110] },
                { name: "CO (ppm)", data: [], color: "#047857", range: [0, 9] },
                { name: "NO2 (ppb)", data: [], color: "#991B1B", range: [0, 100] }
            ],
            wqms: [
                { name: "pH", data: [], color: "#2563EB", range: [6, 9] },
                { name: "Dissolved Oxygen (mg/L)", data: [], color: "#7C3AED", range: [0, 14] },
                { name: "Turbidity (NTU)", data: [], color: "#059669", range: [0, 20] },
                { name: "Conductivity (µS/cm)", data: [], color: "#DC2626", range: [50, 1000] }
            ],
            sqms: [
                { name: "Soil Moisture (%)", data: [], color: "#3B82F6", range: [10, 50] },
                { name: "Soil Temperature (°C)", data: [], color: "#8B5CF6", range: [0, 40] },
                { name: "Soil pH", data: [], color: "#10B981", range: [4, 8] },
                { name: "Nitrogen Content (mg/kg)", data: [], color: "#EF4444", range: [0, 60] }
            ],
            gqms: [
                { name: "CO2 (ppm)", data: [], color: "#60A5FA", range: [300, 1000] },
                { name: "CH4 (ppm)", data: [], color: "#A78BFA", range: [0, 5] },
                { name: "O2 (%)", data: [], color: "#34D399", range: [19, 21] },
                { name: "H2S (ppb)", data: [], color: "#F87171", range: [0, 20] }
            ]
        };

        function generateRealisticData(hours, range) {
            const now = new Date();
            const data = [];
            let lastValue = (range[0] + range[1]) / 2; // Start with the middle value
            for (let i = hours - 1; i >= 0; i--) {
                const time = new Date(now.getTime() - i * 60 * 60 * 1000);
                // Generate a new value that's close to the last value, but within the range
                let newValue = lastValue + (Math.random() - 0.5) * (range[1] - range[0]) * 0.1;
                newValue = Math.max(range[0], Math.min(range[1], newValue)); // Ensure value is within range
                data.push({
                    x: time.toISOString(),
                    y: parseFloat(newValue.toFixed(2))
                });
                lastValue = newValue;
            }
            return data;
        }

        function updateDatasets(hours) {
            Object.keys(datasets).forEach(system => {
                datasets[system].forEach(series => {
                    series.data = generateRealisticData(hours, series.range);
                });
            });
        }

        function createChartOptions(selectedSystem, timeFilter) {
            let series;
            if (selectedSystem === 'all') {
                series = Object.values(datasets).flat();
            } else {
                series = datasets[selectedSystem];
            }

            return {
                series: series,
                chart: {
                    height: 500,
                    type: 'line',
                    zoom: {
                        enabled: false
                    },
                    toolbar: {
                        show: false
                    }
                },
                dataLabels: {
                    enabled: false
                },
                stroke: {
                    width: 2,
                    curve: 'smooth'
                },
                title: {
                    text: 'Environmental Monitoring Data',
                    align: 'left'
                },
                legend: {
                    position: 'top',
                    horizontalAlign: 'left',
                    fontSize: '12px',
                    fontWeight: 500,
                    fontFamily: 'Inter, sans-serif',
                },
                markers: {
                    size: 0,
                    hover: {
                        sizeOffset: 6
                    }
                },
                xaxis: {
                    type: 'datetime',
                },
                yaxis: {
                    title: {
                        text: 'Value'
                    },
                    max: 115
                },
                tooltip: {
                    x: {
                        format: 'dd MMM yyyy HH:mm'
                    }
                },
                grid: {
                    borderColor: '#e7e7e7',
                },
            };
        }

        let chart;

        function updateChart() {
            const selectedSystem = document.getElementById('system-selector').value;
            const timeFilter = document.getElementById('time-filter').value;
            let hours;
            switch (timeFilter) {
                case '7d': hours = 168; break;
                case '3d': hours = 72; break;
                case '24h': hours = 24; break;
                case '12h': hours = 12; break;
                case '3h': hours = 3; break;
                default: hours = 168;
            }
            updateDatasets(hours);
            const chartOptions = createChartOptions(selectedSystem, timeFilter);
            if (chart) {
                chart.updateOptions(chartOptions);
            } else {
                chart = new ApexCharts(document.querySelector("#chart-container"), chartOptions);
                chart.render();
            }
        }

        document.addEventListener("DOMContentLoaded", function() {
            updateChart();

            document.getElementById('system-selector').addEventListener('change', updateChart);
            document.getElementById('time-filter').addEventListener('change', updateChart);
        });
    </script>
</body>
</html>
