<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Environmental Monitoring Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        select, #time-filter {
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ced4da;
            border-radius: 4px;
        }
        #chart-container {
            height: 500px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Environmental Monitoring Dashboard</h1>
        <div class="controls">
            <select id="system-selector">
                <option value="all">All Systems</option>
                <option value="aqms">Air Quality Monitoring System</option>
                <option value="wqms">Water Quality Monitoring System</option>
                <option value="sqms">Soil Quality Monitoring System</option>
                <option value="gqms">Gas Quality Monitoring System</option>
            </select>
            <select id="time-filter">
                <option value="7d">Last 7 Days</option>
                <option value="3d">Last 3 Days</option>
                <option value="24h">Last 24 Hours</option>
                <option value="12h">Last 12 Hours</option>
                <option value="3h">Last 3 Hours</option>
            </select>
        </div>
        <div id="chart-container"></div>
    </div>

    <script>
        function generateTimestampedData(parameterName, baseValue, variance, count) {
            const endDate = new Date();
            const data = [];
            for (let i = count - 1; i >= 0; i--) {
                const timestamp = new Date(endDate - i * 3600 * 1000); // 1 hour intervals
                const value = baseValue + (Math.random() - 0.5) * variance;
                data.push([timestamp.getTime(), parseFloat(value.toFixed(2))]);
            }
            return { name: parameterName, data: data };
        }

        const dummyData = {
            aqms: [
                generateTimestampedData("PM2.5 (µg/m³)", 25, 10, 168),
                generateTimestampedData("PM10 (µg/m³)", 45, 15, 168),
                generateTimestampedData("CO (ppm)", 1, 0.5, 168),
                generateTimestampedData("NO2 (ppb)", 15, 8, 168)
            ],
            wqms: [
                generateTimestampedData("pH", 7, 0.5, 168),
                generateTimestampedData("Dissolved Oxygen (mg/L)", 6, 2, 168),
                generateTimestampedData("Turbidity (NTU)", 3, 2, 168),
                generateTimestampedData("Conductivity (µS/cm)", 50, 10, 168) // Adjusted base value and variance
            ],
            sqms: [
                generateTimestampedData("Soil Moisture (%)", 35, 10, 168),
                generateTimestampedData("Soil Temperature (°C)", 22, 5, 168),
                generateTimestampedData("Soil pH", 6.5, 0.5, 168),
                generateTimestampedData("Nitrogen Content (mg/kg)", 20, 10, 168)
            ],
            gqms: [
                generateTimestampedData("CO2 (ppm)", 40, 5, 168), // Adjusted base value and variance
                generateTimestampedData("CH4 (ppm)", 1.8, 0.5, 168),
                generateTimestampedData("O2 (%)", 20.8, 0.5, 168),
                generateTimestampedData("H2S (ppb)", 2, 3, 168)
            ]
        };

        function getDataForTimeRange(fullData, hours) {
            const endTime = new Date().getTime();
            const startTime = endTime - hours * 3600 * 1000;
            return fullData.map(series => ({
                ...series,
                data: series.data.filter(point => point[0] >= startTime && point[0] <= endTime)
            }));
        }

        function createChartOptions(selectedSystem, timeFilter) {
            let series;
            if (selectedSystem === 'all') {
                series = Object.values(dummyData).flat();
            } else {
                series = dummyData[selectedSystem];
            }

            let hours;
            switch (timeFilter) {
                case '7d': hours = 168; break;
                case '3d': hours = 72; break;
                case '24h': hours = 24; break;
                case '12h': hours = 12; break;
                case '3h': hours = 3; break;
                default: hours = 168;
            }

            series = getDataForTimeRange(series, hours);

            return {
                series: series,
                chart: {
                    height: 500,
                    type: 'line',
                    zoom: {
                        enabled: false
                    },
                    toolbar: {
                        show: false
                    }
                },
                dataLabels: {
                    enabled: false
                },
                stroke: {
                    width: 2,
                    curve: 'smooth'
                },
                title: {
                    text: 'Environmental Monitoring Data',
                    align: 'left'
                },
                legend: {
                    position: 'top',
                    horizontalAlign: 'left',
                    fontSize: '12px',
                    fontWeight: 500,
                    fontFamily: 'Inter, sans-serif',
                },
                markers: {
                    size: 0,
                    hover: {
                        sizeOffset: 6
                    }
                },
                xaxis: {
                    type: 'datetime',
                },
                yaxis: {
                    title: {
                        text: 'Value'
                    },
                },
                tooltip: {
                    x: {
                        format: 'dd MMM yyyy HH:mm'
                    }
                },
                grid: {
                    borderColor: '#e7e7e7',
                },
            };
        }

        let chart;

        function updateChart() {
            const selectedSystem = document.getElementById('system-selector').value;
            const timeFilter = document.getElementById('time-filter').value;
            const chartOptions = createChartOptions(selectedSystem, timeFilter);
            if (chart) {
                chart.updateOptions(chartOptions);
            } else {
                chart = new ApexCharts(document.querySelector("#chart-container"), chartOptions);
                chart.render();
            }
        }

        document.addEventListener("DOMContentLoaded", function() {
            updateChart();

            document.getElementById('system-selector').addEventListener('change', updateChart);
            document.getElementById('time-filter').addEventListener('change', updateChart);
        });
    </script>
</body>
</html>
